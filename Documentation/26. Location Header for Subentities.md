# LOCATION HEADER FOR SUBENTITIES

- For this part we want to create the proper header for `CreateDish` method to indicate that the newly created dish is 
available in the `GetByIdForRestaurant` method by its url
- We add int because:
  - After creating a dish, we must return its ID so the API can tell the client where to find it.
  - So all layers must return the dishId and restaurantId (already have) values so the controller can build the Location URL
  - Then controller will know the id that dish we just created

---
### **`CreatedAtAction`**

CreatedAtAction is designed to answer 3 important questions (three parameter we need to put) after creating something:

- ✅ What endpoint can retrieve it?
- ✅ What IDs are needed to build the URL?
- ✅ What (if anything) should be in the response body?

---

### DishesController.cs
First we need to edit `DishesController.cs` file
- In the CreateDish method, we return CreatedAtAction so the API returns 201 Created and a Location header pointing to the newly created dish, instead of just returning Ok.
- Need to point out to the `GetByIdForRestaurant` by using `nameof` operator because that is **the endpoint that can retrieve the dish we just created**.
- We also need to pass new route parameter that have in `GetByIdForRestaurant` like `restaurantId` and `dishId`, and last parameter we return `null` for body
- But `CreateDish` already have restaurantId parameter. Meanwhile for dishId parameter we need to return it from command
  that we are sending to the mediator interface
- We create var dishId and equal to our mediator earlier

```csharp
    [HttpPost]
    public async Task<IActionResult> CreateDish([FromRoute] int restaurantId, CreateDishCommand command)
    {
        command.RestaurantId = restaurantId;
        var dishId = await mediator.Send(command);
        return CreatedAtAction(nameof(GetByIdForRestaurant), new {restaurantId, dishId}, null);
    }
```
---

### CreateDishCommand.cs
Then, we need to edit `CreateDishCommand.cs`
- For `IRequest` interface we need to return an int value

```csharp
public class CreateDishCommand : IRequest<int>
```
---

### CreateDishCommandHandler.cs
Next, we need to edit `CreateDishCommandHandler.cs`
- For `IRequestHandler` we also need to indicate int value
- For `Handle` method we also indicate `Task<int>`
- Add return in front of `await dishesRepository.Create(dish);`

```csharp
public class CreateDishCommandHandler(ILogger<CreateDishCommandHandler> logger,
    IRestaurantsRepository restaurantsRepository,
    IDishesRepository dishesRepository, IMapper mapper) : IRequestHandler<CreateDishCommand,int>
{
    public async Task<int> Handle(CreateDishCommand request, CancellationToken cancellationToken)
    {
        logger.LogInformation("Creating new dish {@DishRequest}", request);
        var restaurant = await restaurantsRepository.GetByIdAsync(request.RestaurantId);
        if (restaurant == null) throw new NotFoundException(nameof(Restaurant), 
            request.RestaurantId.ToString());
        
        var dish = mapper.Map<Dish>(request); // Setup in DishesProfile.cs
        return await dishesRepository.Create(dish); // Create IDishesRepository.cs and DishesRepository.cs
    }
}
```

Lastly, we run application and check in swagger. 
- Use Post method to create new dish for restaurantId 1 and check the response
- It will give the location with the restaurant id and dish id that we created

The result is like below:

```yaml
content-length: 0
date: Tue,20 Jan 2026 14:05:38 GMT
location: http://localhost:5204/api/restaurant/1/dishes/16
server: Kestrel
```

- RestaurantId : 1
- DishId : 16


---




