# Filtering Results

**Overview**

This enhancement introduces a search filtering capability for retrieving restaurants. Users can now pass a search phrase 
via query parameters to filter restaurants by name or description.

Example:
```yaml
GET /api/restaurants?searchPhrase=pizza
```

---

##  Update Query Object

### File: GetAllRestaurantsQuery.cs

```csharp
namespace Restaurants.Application.Restaurants.Queries.GetAllRestaurants;

public class GetAllRestaurantsQuery : IRequest<IEnumerable<RestaurantDto?>>
{
    public string? SearchPhrase {get; set;}
}
```

✅ Why this is important:
- Keeps filtering logic inside the Application layer.
- Maintains separation of concerns.
- Makes the endpoint flexible without creating multiple APIs.

---

## Update Repository Interface

### File: IRestaurantsRepository.cs

Implement the interface

Define the contract for retrieving filtered restaurant data.

```csharp
Task<IEnumerable<Restaurant>> GetAllMatchingAsync(string? searchPhrase);
```

✅ Best Practice:
- Always define behavior in the interface before implementing it.
- Keeps the Application layer independent from Infrastructure.

---



## Implement Repository Logic

### File: RestaurantRepository.cs

Add the filtering method: GetAllMathcingAsync

```csharp
public async Task<IEnumerable<Restaurant>> GetAllMatchingAsync(string? searchPhrase)
{
    var searchPhraseLower = searchPhrase?.ToLower();
    
    var restaurants = await dbContext.Restaurants
        .Where(r => searchPhraseLower == null || (r.Name.ToLower().Contains(searchPhraseLower) 
                                                  || r.Description.ToLower().Contains(searchPhraseLower)))
        .ToListAsync();
    
    return restaurants;
}
```

---







## Update Query Handler

### File: GetAllRestaurantsQueryHandler.cs

Replace the existing method call:

```csharp
// Replace GetAllAsync Method with GetAllMatchingAsync
var restaurants = await restaurantRepository.GetAllMatchingAsync(request.SearchPhrase);
```

✅ Result:

The handler now supports optional filtering without changing its responsibility.

---

## Update Controller Endpoint

### RestaurantsController.cs

Modify the GetAll endpoint to accept query parameters.

```csharp
[HttpGet]
[AllowAnonymous]
// [Authorize(Policy = PolicyNames.CreatedAtLeast2Restaurants)]
public async Task<IActionResult> GetAll([FromQuery]  GetAllRestaurantsQuery query)
{
    var restaurants = await mediator.Send(query);
    return Ok(restaurants);
}
```

✅ Why [FromQuery]?
- Explicitly binds HTTP query parameters to the request object.
- Improves readability.
- Prevents model binding ambiguity.

---
