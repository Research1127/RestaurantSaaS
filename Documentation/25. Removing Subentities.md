# REMOVING SUBENTITIES

Edit `Restaurants.Api/Controllers/DishesController.cs`

### DishesController.cs
- Add `HttpDelete` method to the controller
- Use `IActionResult` as we dont need to return any type of body
- Create the function called `DeleteDishesForRestaurant`
- Specify the `restaurantId` that is coming from route
- Send the command to `mediator` that will delete all dishes based on specific `restaurantId` called `DeleteDishesForRestaurantCommand`
- return `NoContent()`

```csharp
    [HttpDelete]
    public async Task<IActionResult> DeleteDishesForRestaurant([FromRoute] int restaurantId)
    {
        await mediator.Send(new DeleteDishesForRestaurantCommand(restaurantId));
        return NoContent();
    }
```

---

Create file `Restaurants.Application/Dishes/Commands/DeleteDishes/DeleteDishesForRestaurantCommand.cs`

### DeleteDishesForRestaurantCommand.cs
- Implement `IRequest` interface and no return type because we dont want to return anything
- Create `RestaurantId` properties and initialize it in our primary constructor

```csharp
namespace Restaurants.Application.Dishes.Commands.DeleteDishes;

public class DeleteDishesForRestaurantCommand(int restaurantId) : IRequest
{
    public int RestaurantId { get; } = restaurantId;
}
```
---

Create file `Restaurants.Application/Dishes/Commands/DeleteDishes/DeleteDishesForRestaurantCommandHandler.cs`

### DeleteDishesForRestaurantCommandHandler.cs
- Inject `ILogger`, `IRestaurantRepository`, `IDishesRepository` interfaces
- Implement `IRequestHandler` interface without returning anything
- Check `RestaurantId` exist or not using `GetByIdAsync` method, if not throw exception
- Using `IDishesRepository` to invoke the Delete method - must create this method later.

```csharp
namespace Restaurants.Application.Dishes.Commands.DeleteDishes;

public class DeleteDishesForRestaurantCommandHandler(ILogger<DeleteDishesForRestaurantCommandHandler> logger,
    IRestaurantsRepository restaurantsRepository,
    IDishesRepository dishesRepository) : IRequestHandler<DeleteDishesForRestaurantCommand>
{
    public async Task Handle(DeleteDishesForRestaurantCommand request, CancellationToken cancellationToken)
    {
        logger.LogWarning("Removing all dishes from restaurant id : {restaurantId}", request.RestaurantId);
        var restaurant = await restaurantsRepository.GetByIdAsync(request.RestaurantId);
        if (restaurant == null) throw new NotFoundException(nameof(Restaurant), request.RestaurantId.ToString());
        
        await dishesRepository.Delete(restaurant.Dishes);
    }
}
```

Edit file `Restaurants.Domain/Repositories/IDishesRepository.cs`

### IDishesRepository.cs
- add Delete method interface
```csharp
Task Delete(IEnumerable<Dish> entities);
```

---
In our `Restaurants.Infrastructure/Repositories/DishesRepository.cs`

### DishesRepository.cs
- Implement the Delete method
- Using `RemoveRange(entities)` ensures we delete only the dishes for this restaurant, not all dishes in the database.
- Entities is a collection of Dish objects that EF is tracking.
```csharp
   public async Task Delete(IEnumerable<Dish> entities)
    {
        dbContext.Dishes.RemoveRange(entities);
        await dbContext.SaveChangesAsync();
    }
```
---





